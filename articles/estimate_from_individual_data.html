<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating fatality risk from individual level data • cfr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating fatality risk from individual level data">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">cfr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cfr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package vignettes</h6></li>
    <li><a class="dropdown-item" href="../articles/estimate_static_severity.html">Calculating a static, delay-adjusted estimate of disease severity</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_time_varying_severity.html">Estimating how disease severity varies over the course of an outbreak</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_ascertainment.html">Estimating the proportion of cases that are ascertained during an outbreak</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_from_individual_data.html">Estimating fatality risk from individual level data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Handling data from other packages</h6></li>
    <li><a class="dropdown-item" href="../articles/data_from_incidence2.html">Handling data from {incidence2}</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Handling delay distributions</h6></li>
    <li><a class="dropdown-item" href="../articles/delay_distributions.html">A primer on working with delay distributions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Sotware permissions and regulations</h6></li>
    <li><a class="dropdown-item" href="../articles/software-permissions.html">Software permissions and regulations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/cfr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimating fatality risk from individual level data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/cfr/blob/main/vignettes/estimate_from_individual_data.Rmd" class="external-link"><code>vignettes/estimate_from_individual_data.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_from_individual_data.Rmd</code></div>
    </div>

    
    
<p>The main examples showcased in the vignettes of the <em>cfr</em>
package use incidence data (i.e. counts of cases and deaths by day).
However, in some instances individual-level data (i.e. where each row
provides information about a single case) will be available, which opens
up additional analysis options, but also some potential biases.</p>
<div class="section level2 unnumbered alert alert-primary">
<h2 class="unnumbered" id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>We want to estimate the case fatality risk (CFR) from
individual-level linelist data.</p>
</div>
<div class="section level3 unnumbered alert alert-secondary">
<h3 class="unnumbered" id="what-we-have">What we have<a class="anchor" aria-label="anchor" href="#what-we-have"></a>
</h3>
<ul>
<li>A linelist of case onset timings, as well as either individual
outcome (i.e. death, recovery) if it has occurred by this point and been
recorded, or total deaths.</li>
<li>Data on the distribution of delay from onset-to-death, describing
the probability an individual will die
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
days after they were initially infected.</li>
</ul>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load {cfr}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># packages to wrangle and plot data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="estimation-based-on-cases-with-known-outcomes">Estimation based on cases with known outcomes<a class="anchor" aria-label="anchor" href="#estimation-based-on-cases-with-known-outcomes"></a>
</h2>
<p>If we have individual-level data on case onset timings and outcomes,
where available, it is common to filter the data to focus on cases only
with known outcomes. This means the case fatality risk can then be
calculated from this filtered dataset containing only known outcomes:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mtext mathvariant="normal">Total deaths</mtext><mrow><mtext mathvariant="normal">Total deaths</mtext><mo>+</mo><mtext mathvariant="normal">Total recoveries</mtext></mrow></mfrac><annotation encoding="application/x-tex">
\frac{\text{Total deaths}}{\text{Total deaths}+ \text{Total recoveries}}
</annotation></semantics></math></p>
<p>One limitation of this method is that it implicitly assumes the delay
from onset-to-death and onset-to-recovery are the same (see below for
the mathematical proof). If these delays are noticeably different, the
above calculation will produce a biased estimate of the CFR. For
example, if onset-to-recovery is much longer than onset-to-death, at a
given time point mid-outbreak, the denominator above will be an
underestimate of the true number of cases that would eventually recover
who have similar onset timings to those that would eventually die. Hence
this calculation would inflate the CFR estimate. After the mathematical
explanation below, the next section will discuss estimation methods
based on the expected number of known death outcomes using functionality
in <em>cfr</em>.</p>
<div class="section level3">
<h3 id="mathematical-explanation-for-bias">Mathematical explanation for bias<a class="anchor" aria-label="anchor" href="#mathematical-explanation-for-bias"></a>
</h3>
<p>If we have a linelist with known outcomes and onset-death delay
follows the same distribution as onset-recovery, and CFR =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>,
then at the current time,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total deaths to date</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>∑</mo><mi>t</mi></munder><mi>p</mi><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>f</mi><mi>j</mi></msub><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
E(\text{Total deaths to date}) = \sum_{t} p \sum_j f_{j} I_{t-j} 
</annotation></semantics></math></p>
<p>and</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total recoveries to date</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>∑</mo><mi>t</mi></munder><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>f</mi><mi>j</mi></msub><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
E(\text{Total recoveries to date}) = \sum_{t}(1-p) \sum_j f_{j} I_{t-j} 
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>t</mi></msub><annotation encoding="application/x-tex">I_t</annotation></semantics></math>
is number of new symptomatic infections on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>i</mi></msub><annotation encoding="application/x-tex">f_i</annotation></semantics></math>
is the probability of outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
days after symptom onset.</p>
<p>Hence <span class="math display">$$
E(\text{Total deaths})/ [ E(\text{Total deaths})+E(\text{Total
recoveries}) ] \\
=[ \sum_{t} p \sum_j f_{j} I_{t-j} ]/[ \sum_{t} p \sum_j f_{j}
I_{t-j}  +  \sum_{t}(1-p) \sum_j f_{j} I_{t-j}] \\
=[p \sum_{t}  \sum_j f_{j} I_{t-j} ]/[ \sum_{t}  \sum_j f_{j} I_{t-j}
]   = p
$$</span></p>
<p>However, if delay to death
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>f</mi><mi>j</mi><mi>D</mi></msubsup><annotation encoding="application/x-tex">f_j^D</annotation></semantics></math>
is different to delay to recovery
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>f</mi><mi>j</mi><mi>R</mi></msubsup><annotation encoding="application/x-tex">f_j^R</annotation></semantics></math>,
we have:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total deaths</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total deaths</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total recoveries</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>t</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><mi>p</mi><msubsup><mi>f</mi><mi>j</mi><mi>D</mi></msubsup><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>t</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><mi>p</mi><msubsup><mi>f</mi><mi>j</mi><mi>D</mi></msubsup><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>t</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>f</mi><mi>j</mi><mi>R</mi></msubsup><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
E(\text{Total deaths})/ [ E(\text{Total deaths})+E(\text{Total recoveries}) ]  = \frac{\sum_{t} \sum_j p f_j^D I_{t-j}}{\sum_{t} \sum_j p f_j^D I_{t-j} + \sum_{t} \sum_j (1-p) f_j^R I_{t-j}}
</annotation></semantics></math> And hence this will not simplify to
provide an unbiased estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>,
as if would if $ f_j^D = f_j^R $</p>
</div>
</div>
<div class="section level2">
<h2 id="estimation-based-on-expected-number-of-known-death-outcomes">Estimation based on expected number of known death outcomes<a class="anchor" aria-label="anchor" href="#estimation-based-on-expected-number-of-known-death-outcomes"></a>
</h2>
<p>If the delay from onset-to-death and onset-to-recovery are different,
one option is to use <a href="https://academic.oup.com/aje/article/162/5/479/82647" class="external-link">survival
analysis methods</a> to estimate relative hazards (i.e. fatality risk)
over time.</p>
<p>However, if we are only interested in an overall estimate of CFR, a
simpler alternative is to first calculate the number of cases in the
linelist that we would expect to have a known outcome by this point if
the outcome were fatal:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">deaths by time </mtext><mspace width="0.333em"></mspace></mrow><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><munder><mo>∑</mo><mi>t</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>f</mi><mi>j</mi></msub><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
E(\text{deaths by time }t)  
= p \sum_{t} \sum_j f_{j} I_{t-j} 
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the CFR.</p>
<p>We can then rearrange the above to calculate the CFR: <span class="math display">$$
\text{Total deaths} = p \sum_{t} \sum_j f_{j} I_{t-j} \\
p = \frac{\text{Total deaths}}{\sum_{t} \sum_j f_{j} I_{t-j} }
$$</span> This is the calculation performed by
<code><a href="../reference/cfr_static.html">cfr_static()</a></code>, and hence this function can give us a better
estimate of CFR when delays to death and recovery are not the same.</p>
</div>
<div class="section level2">
<h2 id="simulated-comparison-of-above-methods">Simulated comparison of above methods<a class="anchor" aria-label="anchor" href="#simulated-comparison-of-above-methods"></a>
</h2>
<p>To compare these methods, i.e. filtering out cases without known
outcomes vs using the <code>cfr_static</code> function, we first
simulate 1000 case onset timings and outcomes (i.e. deaths and
recoveries)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1e3</span> <span class="co"># Number of cases to simulate</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Assumed CFR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="co"># Set seed for reproducibility</span></span>
<span></span>
<span><span class="co"># Generate random case onset timings in Jan &amp; Feb 2024</span></span>
<span><span class="va">case_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="va">nn</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define current date of data availability (i.e. max follow up)</span></span>
<span><span class="va">max_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-01-20"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample delays from onset to outcome</span></span>
<span></span>
<span><span class="co"># 1. Deaths: assume mean delay = 5 days, sd = 5 days</span></span>
<span><span class="va">log_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fl">1.262864</span>, sdlog <span class="op">=</span> <span class="fl">0.8325546</span><span class="op">)</span></span>
<span><span class="va">delay_death</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>    meanlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"meanlog"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"sdlog"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">outcome_death</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nn</span> <span class="op">*</span> <span class="va">pp</span><span class="op">)</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"meanlog"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"sdlog"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Recoveries: assume mean delay = 15 days, sd = 5 days</span></span>
<span><span class="va">log_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fl">2.65537</span>, sdlog <span class="op">=</span> <span class="fl">0.3245928</span><span class="op">)</span></span>
<span><span class="va">outcome_recovery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nn</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"meanlog"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="va">log_param</span><span class="op">[[</span><span class="st">"sdlog"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create vector of outcome dates</span></span>
<span><span class="va">all_outcomes</span> <span class="op">&lt;-</span> <span class="va">case_onsets</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">outcome_death</span>, <span class="va">outcome_recovery</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create vector of outcome types</span></span>
<span><span class="va">type_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">outcome_death</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">outcome_recovery</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create vector of known outcomes as of max_obs</span></span>
<span><span class="va">known_outcomes</span> <span class="op">&lt;-</span> <span class="va">type_outcome</span></span>
<span><span class="va">known_outcomes</span><span class="op">[</span><span class="op">(</span><span class="va">all_outcomes</span> <span class="op">&gt;</span> <span class="va">max_obs</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data frame with onset and outcome dates, and outcome type</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nn</span>,</span>
<span>  case_onsets <span class="op">=</span> <span class="va">case_onsets</span>,</span>
<span>  outcome_dates <span class="op">=</span> <span class="va">all_outcomes</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="va">type_outcome</span>,</span>
<span>  known_outcome <span class="op">=</span> <span class="va">known_outcomes</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter out unknown outcomes (after the max_obs date)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">known_outcome</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrange data by onset date</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">case_onsets</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_ordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Assign a new 'id_ordered'</span></span>
<span></span>
<span><span class="co"># Prepare data for plotting (onset and outcome events in same column)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">case_onsets</span>, <span class="va">outcome_dates</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"event_type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"date"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    event_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">event_type</span> <span class="op">==</span> <span class="st">"case_onsets"</span>, <span class="st">"Onset"</span>, <span class="st">"Outcome"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plot with lines linking onset and outcome</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">case_onsets</span>,</span>
<span>                     xend <span class="op">=</span> <span class="va">outcome_dates</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">id_ordered</span>,</span>
<span>                     yend <span class="op">=</span> <span class="va">id_ordered</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">outcome_type</span> <span class="op">==</span> <span class="st">"D"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>,</span>
<span>                                   y <span class="op">=</span> <span class="va">id_ordered</span>,</span>
<span>                                   color <span class="op">=</span> <span class="va">outcome_type</span>,</span>
<span>                                   shape <span class="op">=</span> <span class="va">event_label</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">max_obs</span><span class="op">)</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>D <span class="op">=</span> <span class="st">"darkred"</span>, R <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Onset <span class="op">=</span> <span class="fl">16</span>, Outcome <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individual (Ordered by onset date)"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Outcome type"</span>,</span>
<span>    shape <span class="op">=</span> <span class="st">"Event type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<div class="figure">
<img src="estimate_from_individual_data_files/figure-html/unnamed-chunk-3-1.png" alt="Individual level timings of onsets and outcomes, for individuals with a known outcome as of 20th Jan 2024." width="100%"><p class="caption">
Individual level timings of onsets and outcomes, for individuals with a
known outcome as of 20th Jan 2024.
</p>
</div>
<p>First, we calculate CFR by filtering to focus only on cases with
known outcomes:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter on known outcomes</span></span>
<span><span class="va">total_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">known_outcomes</span> <span class="op">==</span> <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="va">total_outcomes</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">total_deaths</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">known_outcomes</span> <span class="op">==</span> <span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate CFR with 95% CI</span></span>
<span><span class="va">cfr_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html" class="external-link">binom.test</a></span><span class="op">(</span><span class="va">total_deaths</span>, <span class="va">total_outcomes</span><span class="op">)</span></span>
<span><span class="va">cfr_estimate</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cfr_filter</span><span class="op">$</span><span class="va">estimate</span>,</span>
<span>                                     <span class="va">cfr_filter</span><span class="op">$</span><span class="va">conf.int</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfr_estimate</span></span>
<span><span class="co">#&gt; [1] 0.264 0.176 0.370</span></span></code></pre></div>
<p>Next, we calculate CFR based on expected fatal outcomes known to
date, using <code><a href="../reference/cfr_static.html">cfr_static()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get times of death for fatal outcomes</span></span>
<span><span class="va">death_times</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">case_onsets</span><span class="op">)</span><span class="op">[</span><span class="va">type_outcome</span> <span class="op">==</span> <span class="st">"D"</span><span class="op">]</span> <span class="op">+</span> <span class="va">outcome_death</span></span>
<span></span>
<span><span class="co"># Create a single data.frame with event types</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">case_onsets</span>, <span class="va">death_times</span><span class="op">)</span>,</span>
<span>  event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">case_onsets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"deaths"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">death_times</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use incidence2 to calculate counts of cases and deaths by day</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://www.reconverse.org/incidence2/reference/incidence.html" class="external-link">incidence</a></span><span class="op">(</span><span class="va">events</span>,</span>
<span>                                date_index <span class="op">=</span> <span class="st">"dates"</span>,</span>
<span>                                groups <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>                                complete_dates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pivot incidence object to get data.frame with counts for cases and deaths</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">counts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">event</span>,</span>
<span>                     values_from <span class="op">=</span> <span class="va">count</span>,</span>
<span>                     values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">date_index</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cfr_static.html">cfr_static</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">delay_death</span><span class="op">)</span></span>
<span><span class="co">#&gt;   severity_estimate severity_low severity_high</span></span>
<span><span class="co">#&gt; 1            0.1042        0.086        0.1245</span></span></code></pre></div>
<p>Hence in this particular simulation, the <code><a href="../reference/cfr_static.html">cfr_static()</a></code>
method recovers the correct CFR of 10% (95% CI: 8.3-12.0%), whereas the
filtering method produces a biased estimate of 26.4% (17.6-37.0%).</p>
</div>
<div class="section level2">
<h2 id="deaths-reported-but-not-recoveries">Deaths reported but not recoveries<a class="anchor" aria-label="anchor" href="#deaths-reported-but-not-recoveries"></a>
</h2>
<p>In an extreme scenario where recoveries are not reported, then we
effectively have the values of <code>outcome_recovery</code> generated
from a distribution with an infinite mean, and the above conclusions
will still apply, with the same bias for the filtering approach. In
particular, we would expect:</p>
<p><span class="math display">$$
E(\text{Total deaths})/ [ E(\text{Total deaths})+E(\text{Total
recoveries}) ] \rightarrow 1 \\
\text{as } E(\text{Total recoveries}) \rightarrow 0
$$</span> And hence the calculated CFR to incorrectly converge to 1 as
the proportion of recoveries reported declines to 0.</p>
</div>
<div class="section level2">
<h2 id="only-total-deaths-reported">Only total deaths reported<a class="anchor" aria-label="anchor" href="#only-total-deaths-reported"></a>
</h2>
<p>In some situations, we may have a time series of cases but not
deaths. However, we can still use the earlier calculation to derive an
unbiased CFR: <span class="math display">$$
E(\text{Total deaths}) = p \sum_{t} \sum_j f_{j} I_{t-j} \\
E(p) = \frac{\text{Total deaths}}{\sum_{t} \sum_j f_{j} I_{t-j} }
$$</span> We can do this in <em>cfr</em> using the
<code><a href="../reference/estimate_outcomes.html">estimate_outcomes()</a></code> function to calculate the expected
number of cases with known fatal outcomes in the above denominator:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate total deaths and total cases</span></span>
<span><span class="va">total_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">deaths</span><span class="op">)</span></span>
<span><span class="va">total_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">cases</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data.frame with cases over time only</span></span>
<span><span class="va">df_case</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span><span class="va">df_case</span><span class="op">$</span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Calculate the expected number of known fatal outcomes over time</span></span>
<span><span class="va">e_outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_outcomes.html">estimate_outcomes</a></span><span class="op">(</span><span class="va">df_case</span>, <span class="va">delay_death</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the CFR</span></span>
<span><span class="va">total_deaths</span> <span class="op">/</span> <span class="op">(</span><span class="va">total_cases</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">e_outcomes</span><span class="op">$</span><span class="va">u_t</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1042066</span></span></code></pre></div>
<p>As before, this produces a point estimate of 10.4%, because it is the
same underlying method: the internal function code in
<code><a href="../reference/cfr_static.html">cfr_static()</a></code>, which calls <code><a href="../reference/estimate_outcomes.html">estimate_outcomes()</a></code>,
also tallies up total death. An arguably more elegant approach is to
therefore add total deaths to the case data.frame, and use as an input
for <code><a href="../reference/cfr_static.html">cfr_static()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data.frame with cases over time only</span></span>
<span><span class="va">df_cases</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span><span class="va">df_cases</span><span class="op">$</span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Add total deaths to the final row in the 'deaths' column</span></span>
<span><span class="va">df_cases</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_cases</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">deaths</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate CFR</span></span>
<span><span class="fu"><a href="../reference/cfr_static.html">cfr_static</a></span><span class="op">(</span><span class="va">df_cases</span>, <span class="va">delay_death</span><span class="op">)</span></span>
<span><span class="co">#&gt;   severity_estimate severity_low severity_high</span></span>
<span><span class="co">#&gt; 1            0.1042        0.086        0.1245</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="only-total-cases-and-deaths-reported">Only total cases and deaths reported<a class="anchor" aria-label="anchor" href="#only-total-cases-and-deaths-reported"></a>
</h2>
<p>If only total cases and total deaths are known, it is not possible to
adjust for delays to outcome. However, we can bound our estimate of CFR
by two extreme scenarios. First, if the outbreak is over, and sufficient
time has passed so that all fatal outcomes are now known, i.e.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>∑</mo><mi>t</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>f</mi><mi>j</mi></msub><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>j</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mi>t</mi></munder><msub><mi>I</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">
\sum_{t} \sum_j f_{j} I_{t-j} = \sum_{t} I_t
</annotation></semantics></math> then the CFR would be equal to:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mtext mathvariant="normal">Total deaths</mtext><mtext mathvariant="normal">Total cases</mtext></mfrac></mrow><annotation encoding="application/x-tex">
p = \frac{\text{Total deaths}}{\text{Total cases}}
</annotation></semantics></math> In contrast, if the epidemic is rapidly
growing and still in its early stages, then even an epidemic with a CFR
of 1 may have only generated a very small number of fatal outcomes to
date. Hence we have the following bounds on the possible CFR:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mtext mathvariant="normal">Total deaths</mtext><mtext mathvariant="normal">Total cases</mtext></mfrac><mo>≤</mo><mi>p</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
\frac{\text{Total deaths}}{\text{Total cases}} \leq p \leq 1
</annotation></semantics></math> In other words, during a rapidly
growing epidemic, we can only say that the CFR lies somewhere between
the ratio of total deaths to total cases (as of the last known count)
and 1 (the worst-case scenario).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pratik R. Gupte, Adam Kucharski, Tim Russell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
