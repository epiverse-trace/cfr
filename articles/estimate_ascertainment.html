<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="datadelay">
<title>Estimating the proportion of cases that are reported during an outbreak • datadelay</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating the proportion of cases that are reported during an outbreak">
<meta property="og:description" content="datadelay">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">datadelay</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/estimate_ascertainment.html">Estimating the proportion of cases that are reported during an outbreak</a>
    <a class="dropdown-item" href="../articles/estimate_static_severity.html">Calculating disease severity by adjusting for delays between onset and outcome during an outbreak</a>
    <a class="dropdown-item" href="../articles/estimate_time_varying_severity.html">Estimating how disease severity varies over the course of an outbreak</a>
    <a class="dropdown-item" href="../articles/setup_and_installation.html">Setup and Installation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiverse-trace/datadelay/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="estimate_ascertainment_files/kePrint-0.0.1/kePrint.js"></script><link href="estimate_ascertainment_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimating the proportion of cases that are reported during an outbreak</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/datadelay/blob/HEAD/vignettes/estimate_ascertainment.Rmd" class="external-link"><code>vignettes/estimate_ascertainment.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_ascertainment.Rmd</code></div>
    </div>

    
    
<!-- removes the ugly border around the figures -->
<style>
    img {
        border: 0;
    }
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette outlines the function within <code>datadelay</code>
used to estimate the proportion of cases, infections or hospitalisations
ascertained.</p>
<p>First, we load the key packages required for this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/datadelay" class="external-link">datadelay</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/epiparameter" class="external-link">epiparameter</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiforecasts.io/covidregionaldata/" class="external-link">covidregionaldata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
<p>and the four optional packages, to run the multiple examples in the
last section of this vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>There are several reasons why cases, infections or hospitalisations
and deaths might be under-ascertained during an outbreak of an
infectious disease. Some examples include:</p>
<ul>
<li><p>Testing capacity or criteria is not sufficient to identify all
infections.</p></li>
<li><p>Symptom-based testing rather than sampling at random in the
population. This can lead to biases due to some infections either being
asymptomatic or having a pre-symptomatic phase.</p></li>
<li><p>Changes in case definition over time.</p></li>
</ul>
<p>For example, during the recent COVID-19 pandemic, the U.K. did not
roll out widespread testing until around May 2020. This means that
during March and April, infections were heavily under-ascertained. We
focus on this period within this vignette, as it illustrates the use for
this analysis pipeline well.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<div class="section level3">
<h3 id="data-required">Data required<a class="anchor" aria-label="anchor" href="#data-required"></a>
</h3>
<p>The data required to estimate how the severity of a disease changes
over time using the <code>datadelay</code> package includes:</p>
<ul>
<li>A time-series of cases, hospitalisations or some other proxy for
infections over time;</li>
<li>A time-series of deaths;</li>
<li>A delay distribution, describing the probability an individual will
die <span class="math inline">\(t\)</span> days after they were
initially exposed. Such distributions come from the literature, where
studies have typically fit distributions to data describing the
process.</li>
</ul>
<p>In practice, the time-series of cases and deaths will already be
together, given that they usually originate from sources that will have
typically collated them into a single data file.</p>
<p>The package requires a <code>data.frame</code> of input data —
typically case and death time series data — and a delay distribution.
The delay distribution we use here comes from the
<code>epiparameter</code> package.</p>
</div>
<div class="section level3">
<h3 id="estimating-the-proportion-of-cases-or-infections-that-have-been-ascertained">Estimating the proportion of cases or infections that have been
ascertained<a class="anchor" aria-label="anchor" href="#estimating-the-proportion-of-cases-or-infections-that-have-been-ascertained"></a>
</h3>
<p>The function <code><a href="../reference/estimate_reporting.html">estimate_reporting()</a></code> from the
<code>datadelay</code> package estimates the proportion of cases,
infections, hospitalisations — or whichever proxy for infections is
provide — which have been ascertained. The method used within this
function extends the methods outlined in the previous vignettes about
estimating the severity during an ongoing outbreak and measuring how the
severity changes over time. Both methods are based on the <span class="citation">[1]</span> methods to estimate severity. We extend this
by combining the resulting severity estimates with an assumed baseline
severity estimate. The proportion of cases, infections or other quantity
provided that have been ascertained is given by the ratio of the assumed
to be true baseline severity estimate to the delay-adjusted severity
estimate. The delay-adjusted severity estimates can be calculated using
either the <code><a href="../reference/estimate_static.html">estimate_static()</a></code> or the
<code><a href="../reference/estimate_time_varying.html">estimate_time_varying()</a></code> functions.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-with-data-from-the-ongoing-covid-19-pandemic-in-the-u-k-">Example with data from the ongoing COVID-19 pandemic in the
U.K.<a class="anchor" aria-label="anchor" href="#example-with-data-from-the-ongoing-covid-19-pandemic-in-the-u-k-"></a>
</h2>
<p>We outline how the time-varying severity estimation works in
<em>datadelay</em> using a number of examples. The data for all of the
examples is from the ongoing COVID-19 epidemic. Firstly, we analyse the
U.K. data, then we pick three other countries with large outbreaks to
analyse.</p>
<div class="section level3">
<h3 id="downloading-the-raw-data">Downloading the raw data<a class="anchor" aria-label="anchor" href="#downloading-the-raw-data"></a>
</h3>
<p>First of all, we subset the data so that we focus on just the first
few months of the COVID-19 outbreak in the U.K. We do so, as test
availability changed dramatically as a result of the vaccine campaign.
We download the data — using the <code>covidregionaldata</code> package
— with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_covid_uk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiforecasts.io/covidregionaldata/reference/get_national_data.html" class="external-link">get_national_data</a></span><span class="op">(</span></span>
<span>  countries <span class="op">=</span> <span class="st">"united kingdom"</span>, source <span class="op">=</span> <span class="st">"who"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="va">cases_new</span>, deaths <span class="op">=</span> <span class="va">deaths_new</span><span class="op">)</span></span></code></pre></div>
<p>We then subset the data to focus on just the first few months of the
outbreak with the following command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_covid_uk_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df_covid_uk</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2020-05-31"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-raw-data">Plotting the raw data<a class="anchor" aria-label="anchor" href="#plotting-the-raw-data"></a>
</h3>
<p>First, we plot case incidence data with following command:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_case_data.html">plot_case_data</a></span><span class="op">(</span><span class="va">df_covid_uk_subset</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="estimate_ascertainment_files/figure-html/unnamed-chunk-5-1.png" alt="\label{fig:raw_data_covid} **Figure 1:** Incidence of cases over time for the ongoing COVID-19 outbreak in the U.K." width="600"><p class="caption">
<strong>Figure 1:</strong> Incidence of cases over time for the ongoing
COVID-19 outbreak in the U.K.
</p>
</div>
<p>Then, we plot the death incidence data with following command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_death_data.html">plot_death_data</a></span><span class="op">(</span><span class="va">df_covid_uk_subset</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="estimate_ascertainment_files/figure-html/unnamed-chunk-6-1.png" alt="\label{fig:raw_data_covid} **Figure 2:** Incidence of  deaths over time for the ongoing COVID-19 outbreak in the U.K." width="600"><p class="caption">
<strong>Figure 2:</strong> Incidence of deaths over time for the ongoing
COVID-19 outbreak in the U.K.
</p>
</div>
</div>
<div class="section level3">
<h3 id="the-delay-distribution">The delay distribution<a class="anchor" aria-label="anchor" href="#the-delay-distribution"></a>
</h3>
<p>We again retrieve the appropriate distribution — reported <a href="https://doi.org/10.3390/jcm9020538" class="external-link">here</a><sup><span class="citation">[2]</span></sup> — using the <code><a href="https://epiverse-trace.github.io/epiparameter/reference/epidist_db.html" class="external-link">epidist_db()</a></code>
function from the <code>epiparameter</code> package, using the following
command:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onset_to_death_covid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiverse-trace.github.io/epiparameter/reference/epidist_db.html" class="external-link">epidist_db</a></span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"COVID-19"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"onset_to_death"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Linton_etal"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To visualise this distribution, we evaluate it between 0 and 30 days,
and plot the results over time. We do so using the following
command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_epiparameter_distribution.html">plot_epiparameter_distribution</a></span><span class="op">(</span><span class="va">onset_to_death_covid</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="estimate_ascertainment_files/figure-html/unnamed-chunk-8-1.png" alt="\label{fig:delay_dist_covid} **Figure 3: Example plot of the appropriate delay distribution for the COVID-19 epidemic in the U.K.** We plot the onset-to-death distribution we use throughout this example for COVID-19, reported in https://doi.org/10.3390/jcm9020538." width="600"><p class="caption">
<strong>Figure 3: Example plot of the appropriate delay distribution for
the COVID-19 epidemic in the U.K.</strong> We plot the onset-to-death
distribution we use throughout this example for COVID-19, reported in <a href="https://doi.org/10.3390/jcm9020538" class="external-link uri">https://doi.org/10.3390/jcm9020538</a>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="estimating-the-proportion-of-cases-that-have-been-ascertained">Estimating the proportion of cases that have been ascertained<a class="anchor" aria-label="anchor" href="#estimating-the-proportion-of-cases-that-have-been-ascertained"></a>
</h3>
<p>We use the <code><a href="../reference/estimate_reporting.html">estimate_reporting()</a></code> function within the
<code>datadelay</code> package to calculate the time-varying CFR for the
COVID-19 epidemic in the U.K:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reporting_static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_reporting.html">estimate_reporting</a></span><span class="op">(</span></span>
<span>  <span class="va">df_covid_uk_subset</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="va">onset_to_death_covid</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"static"</span>,</span>
<span>  severity_baseline <span class="op">=</span> <span class="fl">0.014</span>,</span>
<span>  correct_for_delays <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/format_output.html">format_output</a></span><span class="op">(</span></span>
<span>    estimate_type <span class="op">=</span> <span class="st">"reporting"</span>, type <span class="op">=</span> <span class="st">"Under-reporting"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The function includes a <code>type</code> argument, which determines
whether <code><a href="../reference/estimate_static.html">estimate_static()</a></code> or
<code><a href="../reference/estimate_time_varying.html">estimate_time_varying()</a></code> is used to estimate the
delay-adjusted severity of the disease used as the numerator in the
under-ascertainment calculation. The <code>severity_baseline</code>
argument in the <code><a href="../reference/estimate_reporting.html">estimate_reporting()</a></code> determines the
denominator in the resulting under-ascertainment calculation. The other
arguments are the same as those found in the
<code><a href="../reference/estimate_time_varying.html">estimate_time_varying()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reporting_varying</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_reporting.html">estimate_reporting</a></span><span class="op">(</span><span class="va">df_covid_uk</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="va">onset_to_death_covid</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"varying"</span>,</span>
<span>  severity_baseline <span class="op">=</span> <span class="fl">0.014</span>,</span>
<span>  smooth_inputs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  burn_in_value <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  correct_for_delays <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_date <span class="op">=</span> <span class="st">"2020-06-30"</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"country"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/format_output.html">format_output</a></span><span class="op">(</span></span>
<span>    estimate_type <span class="op">=</span> <span class="st">"reporting"</span>, type <span class="op">=</span> <span class="st">"Under-reporting"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Once we have calculated both severity quantities over time, we plot
the results. First we plot the naive (uncorrected for delays)
estiamte:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_reporting_static</span>,</span>
<span>  align <span class="op">=</span> <span class="st">"c"</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Location"</span>, <span class="st">"Under-reporting estimate"</span>, <span class="st">"Type"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
Location
</th>
<th style="text-align:center;">
Under-reporting estimate
</th>
<th style="text-align:center;">
Type
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:center;">
United Kingdom
</td>
<td style="text-align:center;">
5.98% (95% CI: 6.01% - 5.93%)
</td>
<td style="text-align:center;">
Under-reporting
</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_reporting_varying</span>,</span>
<span>  align <span class="op">=</span> <span class="st">"c"</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Location"</span>, <span class="st">"Under-reporting estimate"</span>, <span class="st">"Type"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
Location
</th>
<th style="text-align:center;">
Under-reporting estimate
</th>
<th style="text-align:center;">
Type
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:center;">
United Kingdom
</td>
<td style="text-align:center;">
21.76% (95% CI: 27.43% - 17.52%)
</td>
<td style="text-align:center;">
Under-reporting
</td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="example-with-all-countries-with-large-early-covid-19-outbreaks">Example with all countries with large early COVID-19 outbreaks<a class="anchor" aria-label="anchor" href="#example-with-all-countries-with-large-early-covid-19-outbreaks"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_covid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiforecasts.io/covidregionaldata/reference/get_national_data.html" class="external-link">get_national_data</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"who"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="va">cases_new</span>, deaths <span class="op">=</span> <span class="va">deaths_new</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_covid_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df_covid</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2020-05-31"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we put the ascertainment estimates for all countries with
large outbreaks in a single table and summarise the results in a single
figure. We define a large outbreak as one which has caused at least
100,000 deaths. We focus on these countries as the resulting table and
figure become unwieldy if they are made any larger. We focus on the
period between the start of each outbreak to the 1st June 2020. We do so
as it was this period where under-ascertainment of cases and infections
was likely the highest, as tests were still being developed and had not
been made widely available in many countries.</p>
<p>To calculate all ascertainment estimates for all countries with large
COVID-19 outbreaks up to the 1st June 2020, we use the following command
— this codeblock depends on the package <code>dplyr</code>, for ease
with manipulating large data.frames which are structured by group:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reporting</span> <span class="op">&lt;-</span> <span class="va">df_covid</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iso_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total_deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">deaths_total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">total_deaths</span> <span class="op">&gt;</span> <span class="fl">100000</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2020-06-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_reporting</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_map</a></span><span class="op">(</span><span class="va">df_reporting</span>, <span class="op">~</span> <span class="fu"><a href="../reference/estimate_reporting.html">estimate_reporting</a></span><span class="op">(</span></span>
<span>    df_in <span class="op">=</span> <span class="va">.</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="va">onset_to_death_covid</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"varying"</span>,</span>
<span>    severity_baseline <span class="op">=</span> <span class="fl">0.014</span>,</span>
<span>    burn_in_value <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    smooth_inputs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    correct_for_delays <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_reporting_neat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_output.html">format_output</a></span><span class="op">(</span></span>
<span>  df_in <span class="op">=</span> <span class="va">df_reporting</span>,</span>
<span>  estimate_type <span class="op">=</span> <span class="st">"reporting"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"Ascertainment"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, to plot all of these results on a single figure, we use the
following command — this codeblock depends on the commonly used package
<code>ggplot2</code>, for ease with plotting large data.frames:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_reporting</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">reporting_me</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="va">reporting_me</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">reporting_lo</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">reporting_hi</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">location</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Ascertainment Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="estimate_ascertainment_files/figure-html/unnamed-chunk-15-1.png" alt="\label{fig:time_varying_cfr_corrected} **Figure 5: Example plot of the corrected time-varying CFR.** We calculate the time-varying CFR for the ongoing COVID-19 epidemic in United States, corrected for delays." width="600"><p class="caption">
<strong>Figure 5: Example plot of the corrected time-varying
CFR.</strong> We calculate the time-varying CFR for the ongoing COVID-19
epidemic in United States, corrected for delays.
</p>
</div>
<p>Finally, we put the same results in a large table with the following
command:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_reporting_neat</span>,</span>
<span>  align <span class="op">=</span> <span class="st">"c"</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Location"</span>, <span class="st">"Estimate"</span>, <span class="st">"Type"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
Location
</th>
<th style="text-align:center;">
Estimate
</th>
<th style="text-align:center;">
Type
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
Argentina
</td>
<td style="text-align:center;">
10.24% (95% CI: 14.67% - 7.47%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Brazil
</td>
<td style="text-align:center;">
9.06% (95% CI: 9.61% - 8.54%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
China
</td>
<td style="text-align:center;">
100.00% (95% CI: 100.00% - 5.29%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Colombia
</td>
<td style="text-align:center;">
21.79% (95% CI: 34.01% - 14.76%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Germany
</td>
<td style="text-align:center;">
100.00% (95% CI: 100.00% - 73.41%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Spain
</td>
<td style="text-align:center;">
28.44% (95% CI: 36.73% - 22.42%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
France
</td>
<td style="text-align:center;">
22.87% (95% CI: 29.04% - 18.30%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
United Kingdom
</td>
<td style="text-align:center;">
17.67% (95% CI: 19.71% - 15.90%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Indonesia
</td>
<td style="text-align:center;">
15.78% (95% CI: 22.64% - 11.44%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
India
</td>
<td style="text-align:center;">
24.68% (95% CI: 29.07% - 21.11%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Iran
</td>
<td style="text-align:center;">
31.65% (95% CI: 41.69% - 24.54%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Italy
</td>
<td style="text-align:center;">
22.05% (95% CI: 26.63% - 18.45%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Mexico
</td>
<td style="text-align:center;">
4.44% (95% CI: 4.76% - 4.16%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Peru
</td>
<td style="text-align:center;">
6.56% (95% CI: 7.09% - 6.10%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Poland
</td>
<td style="text-align:center;">
41.49% (95% CI: 82.54% - 23.50%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Russia
</td>
<td style="text-align:center;">
87.85% (95% CI: 100.00% - 74.64%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Turkey
</td>
<td style="text-align:center;">
100.00% (95% CI: 100.00% - 78.68%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
Ukraine
</td>
<td style="text-align:center;">
49.65% (95% CI: 92.72% - 29.33%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
United States
</td>
<td style="text-align:center;">
33.78% (95% CI: 35.80% - 31.90%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
<tr>
<td style="text-align:center;">
South Africa
</td>
<td style="text-align:center;">
16.89% (95% CI: 24.73% - 12.05%)
</td>
<td style="text-align:center;">
Ascertainment
</td>
</tr>
</tbody>
</table>
<div id="refs" class="references csl-bib-body">
<div id="ref-nishiura2009early" class="csl-entry">
<div class="csl-left-margin">1 </div>
<div class="csl-right-inline">Nishiura H, Klinkenberg D, Roberts M, <em>et
al.</em> Early epidemiological assessment of the virulence of emerging
infectious diseases: A case study of an influenza pandemic. <em>PloS
one</em> 2009;<strong>4</strong>:e6852.</div>
</div>
<div id="ref-linton2020incubation" class="csl-entry">
<div class="csl-left-margin">2 </div>
<div class="csl-right-inline">Linton NM, Kobayashi T, Yang Y, <em>et al.</em>
Incubation period and other epidemiological characteristics of 2019
novel coronavirus infections with right truncation: A statistical
analysis of publicly available case data. <em>Journal of clinical
medicine</em> 2020;<strong>9</strong>:538.</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adam Kucharski, Tim Russell, Pratik Gupte.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
