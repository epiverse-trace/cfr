---
output: github_document
bibliography: vignettes/resources/library.json
link-citations: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# _{{ packagename }}_: Estimating disease severity and under-reporting

<!-- badges: start -->
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![R-CMD-check](https://github.com/{{ gh_repo }}/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/{{ gh_repo }}/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/{{ gh_repo }}/branch/main/graph/badge.svg)](https://app.codecov.io/gh/{{ gh_repo }}?branch=main)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![CRAN status](https://www.r-pkg.org/badges/version/{{ packagename }})](https://CRAN.R-project.org/package={{ packagename }})
<!-- badges: end -->

_{{ packagename }}_ is an R package to estimate disease severity and under-reporting in real-time, accounting for delays in epidemic time-series.

_{{ packagename }}_ provides simple, fast methods to calculate the overall or static case fatality ratio (CFR) of an outbreak up to a given time point, as well as how the CFR changes over the course of the outbreak.
_{{ packagename }}_ can help estimate disease under-reporting in real-time, accounting for delays reporting the outcomes of cases.

_{{ packagename }}_ implements methods outlined in @nishiura2009, and CFR estimates based on more methods are likely to be added.

_{{ packagename }}_ uses the [_epiparameter_ package](https://epiverse-trace.github.io/epiparameter/) for delay-corrected CFR estimates, and both packages are developed at the [Centre for the Mathematical Modelling of Infectious Diseases](https://www.lshtm.ac.uk/research/centres/centre-mathematical-modelling-infectious-diseases) at the London School of Hygiene and Tropical Medicine as part of the [Epiverse-TRACE initiative](https://data.org/initiatives/epiverse/).

## Installation

The current development version of _{{ packagename }}_ can be installed from [GitHub](https://github.com/) using the `pak` package.

```r
if(!require("pak")) install.packages("pak")
pak::pak("{{ gh_repo }}")

# Also install R package {epiparameter} for epidemiological parameter values
pak::pak("epiverse-trace/epiparameter")
```

## Quick start

### Overall severity of the 1976 Ebola outbreak

This example of basic usage shows how to use _{{ packagename }}_ to estimate the overall case fatality ratios from the 1976 Ebola outbreak.

```{r example-ebola-calc}
# Load package
library(datadelay)

# Load the Ebola 1976 data provided with the package
data("ebola1976")

# read delay distribution for ebolavirus onset to death from {epiparameter}
# accesses parameters reported in https://doi.org/10.1016/S0140-6736(18)31387-4
onset_to_death_ebola <- epiparameter::epidist_db(
  disease = "Ebola Virus Disease",
  epi_dist = "onset_to_death",
  author = "Barry_etal"
)

# Calculate the static CFR without correcting for delays
estimate_static(data = ebola1976)

# Calculate the static CFR while correcting for delays
estimate_static(
  data = ebola1976,
  correct_for_delays = TRUE,
  epi_dist = onset_to_death_ebola
)
```

### Change in real-time estimates of overall severity during the 1976 Ebola outbreak

In this example we show how the estimate of overall severity can change as more data on cases and deaths over time becomes available, using the function `estimate_rolling()`. Because there is a delay from onset-to-death, a simple "naive" calculation that just divides deaths-to-date by cases-to-date will underestimate severity. The `estimate_rolling()` function uses the `estimate_severity()` adjustment to account for delays, and instead compares deaths-to-date with cases-with-known-outcome-to-date.

This example shows how the adjusted estimate converges to "naive" estimate as the outbreak declines, and hence a larger and large proportion of cases have known outcomes.

```{r example-ebola-plot}
# Calculate the CFR without correcting for delays on each day of the outbreak
rolling_cfr_naive <- estimate_rolling(
  data = ebola1976,
)

# add the date from the outbreak
rolling_cfr_naive <- cbind(date = ebola1976[, "date"], rolling_cfr_naive)

# see the first few rows
head(rolling_cfr_naive)

# Calculate the rolling daily CFR while correcting for delays
rolling_cfr_corrected <- estimate_rolling(
  data = ebola1976, correct_for_delays = TRUE,
  epi_dist = onset_to_death_ebola
)

# add the date from the outbreak
rolling_cfr_corrected <- cbind(date = ebola1976[, "date"], rolling_cfr_corrected)

head(rolling_cfr_corrected)
```

We plot the rolling CFR to visualise how severity changes over time, using the [_ggplot2_ package](https://ggplot2.tidyverse.org/). The plotting code is hidden here.

```{r echo=FALSE, fig.cap="Disease severity of ebola in the 1976 outbreak estimated on each day of the epidemic. The rolling CFR value converges to the static value towards the end of the outbreak. Both corrected and uncorrected estimates are shown."}
library(ggplot2)

# visualise both corrected and uncorrected rolling estimates
ggplot() +
  geom_ribbon(
    data = rolling_cfr_naive,
    aes(
      date,
      ymin = severity_lo, ymax = severity_hi,
      fill = "naive"
    ),
    alpha = 0.2, show.legend = FALSE
  ) +
  geom_ribbon(
    data = rolling_cfr_corrected,
    aes(
      date,
      ymin = severity_lo, ymax = severity_hi,
      fill = "corrected"
    ),
    alpha = 0.2, show.legend = FALSE
  ) +
  geom_line(
    data = rolling_cfr_naive,
    aes(date, severity_me, colour = "naive")
  ) +
  geom_line(
    data = rolling_cfr_corrected,
    aes(date, severity_me, colour = "corrected")
  ) +
  scale_colour_brewer(
    palette = "Dark2",
    labels = c("Naive CFR", "Corrected CFR"),
    name = NULL
  ) +
  scale_fill_brewer(
    palette = "Dark2"
  ) +
  scale_x_date(
    date_labels = "%d-%b-%Y",
    name = "Date"
  ) +
  labs(
    y = "Disease severity"
  ) +
  theme(
    legend.position = "top"
  )
```


## Package vignettes

More details on how to use _{{ packagename }}_ can be found in the [online documentation as package vignettes](https://epiverse-trace.github.io/{{ packagename }}/), under "Articles".

## Help

To report a bug please open an [issue](https://github.com/{{ gh_repo }}/issues/new/choose).

## Contribute

Contributions to _{{ packagename }}_ are welcomed. Please follow the [package contributing guide](https://github.com/{{ gh_repo }}/blob/main/.github/CONTRIBUTING.md).

## Code of conduct

Please note that the _{{ packagename }}_ project is released with a [Contributor Code of Conduct](https://github.com/epiverse-trace/.github/blob/main/CODE_OF_CONDUCT.md). By contributing to this project, you agree to abide by its terms.

## References
